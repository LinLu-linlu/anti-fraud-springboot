import{d as W,b as J,r as d,e as r,o as C,z as x,k as t,h as V,j as l,l as c,i as N,t as L,u as e,f as K,A as G,F as q,B as Z,C as ee,D as j,y as le,E as te}from"./index-Da-BD_yu.js";import{a as h}from"./axios-B4uVmeYG.js";const ae={class:"flex gap-2"},oe={class:"dialog-footer"},I="120px",ne=W({__name:"ArticleDialog",props:["addOrUpdate","articleId"],emits:["refresh"],setup(k,{expose:A,emit:P}){const T=k,_=J().appContext.config.globalProperties.$CONST,O=new Date(2e3,1,1,12,0,0),g=d(""),p=d(!1),E=d(),w=P;let m=d(),f=d([]),u=d(!1),s=d({id:null,title:"",content:"",uid:"",datetime:"",img:"",type:""});const z=()=>{h.get(_.AXIOS_API_FRONT+"/user/all").then(o=>{m.value=o.data.data})},S=()=>{h.post(_.AXIOS_API_FRONT+(T.addOrUpdate?"/article/add":"/article/update"),{article:s.value,tags:f.value},{headers:{"Content-Type":"application/json"}}).then(o=>{w("refresh"),u.value=!1})},D=o=>{f.value.splice(f.value.indexOf(o),1)},F=()=>{p.value=!0,ee(()=>{E.value.input.focus()})},R=()=>{g.value&&f.value.push(g.value),p.value=!1,g.value=""},$=()=>{z(),T.addOrUpdate||(h.get(_.AXIOS_API_FRONT+"/article/selectById",{params:{id:T.articleId}}).then(o=>{s.value=o.data.data}),h.get(_.AXIOS_API_FRONT+"/article/selectTagById",{params:{id:T.articleId}}).then(o=>{f.value=o.data.data}))},B=()=>{s=d({id:null,title:"",content:"",uid:"",datetime:"",img:"",type:""}),f=d([])};return A({dialogFormVisible:u}),(o,a)=>{const b=r("el-form-item"),v=r("el-option"),y=r("el-select"),M=r("el-date-picker"),U=r("el-radio"),H=r("el-radio-group"),X=r("el-tag"),i=r("el-button"),Y=r("el-form"),Q=r("el-dialog");return C(),x(Q,{modelValue:e(u),"onUpdate:modelValue":a[7]||(a[7]=n=>N(u)?u.value=n:u=n),title:(k.addOrUpdate?"发布":"更新")+"文章",width:"500",onOpen:$,onClose:B},{footer:t(()=>[V("div",oe,[l(i,{onClick:a[6]||(a[6]=n=>N(u)?u.value=!1:u=!1)},{default:t(()=>[c("取消")]),_:1}),l(i,{type:"primary",onClick:S},{default:t(()=>[c(L(k.addOrUpdate?"发布":"更新"),1)]),_:1})])]),default:t(()=>[l(Y,{model:e(s)},{default:t(()=>[l(b,{label:e(_).ARTICLE_TITLE,"label-width":I},{default:t(()=>[l(e(j),{modelValue:e(s).title,"onUpdate:modelValue":a[0]||(a[0]=n=>e(s).title=n),placeholder:"请输入标题",autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{label:e(_).ARTICLE_AUTHOR,"label-width":I},{default:t(()=>[l(y,{modelValue:e(s).uid,"onUpdate:modelValue":a[1]||(a[1]=n=>e(s).uid=n),filterable:"",placeholder:"请选择作者",style:{width:"300px"}},{default:t(()=>[(C(!0),K(q,null,G(e(m),n=>(C(),x(v,{key:n.username,label:n.nickname,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(b,{label:e(_).ARTICLE_CONTENT,"label-width":I},{default:t(()=>[l(e(j),{modelValue:e(s).content,"onUpdate:modelValue":a[2]||(a[2]=n=>e(s).content=n),style:{width:"300px"},autosize:{minRows:2,maxRows:10},type:"textarea",placeholder:"请输入文章正文"},null,8,["modelValue"])]),_:1},8,["label"]),l(b,{label:e(_).ARTICLE_DATETIME,"label-width":I},{default:t(()=>[l(M,{modelValue:e(s).datetime,"onUpdate:modelValue":a[3]||(a[3]=n=>e(s).datetime=n),type:"datetime",placeholder:"日期和时间","value-format":"YYYY-MM-DD HH:mm:ss","default-time":e(O),style:{width:"300px"}},null,8,["modelValue","default-time"])]),_:1},8,["label"]),l(b,{label:e(_).ARTICLE_TYPE,"label-width":I},{default:t(()=>[l(H,{modelValue:e(s).type,"onUpdate:modelValue":a[4]||(a[4]=n=>e(s).type=n),size:"small"},{default:t(()=>[l(U,{value:"0",border:""},{default:t(()=>[c("资讯")]),_:1}),l(U,{value:"1",border:""},{default:t(()=>[c("求助")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(b,{label:"标签","label-width":I},{default:t(()=>[V("div",ae,[(C(!0),K(q,null,G(e(f),n=>(C(),x(X,{key:n,closable:"","disable-transitions":!1,onClose:re=>D(n),style:{"margin-right":"8px"}},{default:t(()=>[c(L(n),1)]),_:2},1032,["onClose"]))),128)),p.value?(C(),x(e(j),{key:0,ref_key:"InputRef",ref:E,modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=n=>g.value=n),size:"small",onKeyup:Z(R,["enter"]),onBlur:R},null,8,["modelValue"])):(C(),x(i,{key:1,class:"button-new-tag",size:"small",onClick:F},{default:t(()=>[c(" + New Tag ")]),_:1}))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),se={style:{"margin-top":"40px"}},de=V("span",null,"确定删除该条文章吗？",-1),ie={class:"dialog-footer"},ce=W({__name:"ArticlePage",setup(k){const A=d(1),P=d("default"),T=d(!1),_=d(!1),O=d(""),g=d(null),p=J().appContext.config.globalProperties.$CONST;let E=d(),w=d(),m=d(!1);var f=d(!0),u=d();le(()=>{s()});const s=()=>{h.post(p.AXIOS_API_FRONT+"/article/findPage",{currentPage:A.value,pageSize:10,queryString:O.value},{headers:{"Content-Type":"application/json"}}).then(o=>{E.value=o.data.data,w.value=o.data.total})},z=()=>{f.value=!0,g.value.dialogFormVisible=!0},S=o=>{f.value=!1,u.value=o,g.value.dialogFormVisible=!0},D=o=>{m.value=!0,u.value=o},F=()=>{console.log(u.value),h.get(p.AXIOS_API_FRONT+"/article/delete",{params:{id:u.value}}).then(o=>{console.log(o),te({type:"success",message:"删除成功"}),m.value=!1,s()}).catch(o=>{console.error(o)})},R=()=>{s()},$=(o,a)=>a.type===o,B=o=>{s()};return(o,a)=>{const b=r("el-input"),v=r("el-button"),y=r("el-table-column"),M=r("el-tag"),U=r("el-table"),H=r("el-pagination"),X=r("el-dialog");return C(),K(q,null,[V("h1",null,L(e(p).ARTICLE_MANAGE),1),V("div",se,[l(b,{modelValue:O.value,"onUpdate:modelValue":a[0]||(a[0]=i=>O.value=i),style:{width:"240px"},size:"small",placeholder:e(p).ARTICLE_SEARCH_PLACEHOLDER,clearable:""},null,8,["modelValue","placeholder"]),l(v,{type:"primary",style:{"margin-left":"20px"},size:"small",onClick:R},{default:t(()=>[c("搜索")]),_:1}),l(v,{type:"primary",plain:"",style:{"margin-left":"30px"},size:"small",onClick:z},{default:t(()=>[c("添加")]),_:1})]),l(U,{data:e(E),height:"500",style:{width:"100%","margin-top":"30px"},"table-layout":"auto"},{default:t(()=>[l(y,{prop:"title",label:e(p).ARTICLE_TITLE},null,8,["label"]),l(y,{prop:"content",label:e(p).ARTICLE_CONTENT,"show-overflow-tooltip":""},null,8,["label"]),l(y,{prop:"author_name",label:e(p).ARTICLE_AUTHOR},null,8,["label"]),l(y,{prop:"dateTime",label:e(p).ARTICLE_DATETIME},null,8,["label"]),l(y,{prop:"type",label:e(p).ARTICLE_TYPE,filters:[{text:"资讯",value:0},{text:"求助",value:1}],"filter-method":$,"filter-placement":"bottom-end"},{default:t(i=>[l(M,{type:i.row.type===0?"primary":"success","disable-transitions":""},{default:t(()=>[c(L(i.row.type===0?"资讯":"求助"),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(y,{prop:"operations",label:"操作"},{default:t(i=>[l(v,{type:"primary",size:"small",onClick:Y=>S(i.row.id)},{default:t(()=>[c(" 修改 ")]),_:2},1032,["onClick"]),l(v,{size:"small",type:"danger",onClick:Y=>D(i.row.id)},{default:t(()=>[c(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(H,{"current-page":A.value,"onUpdate:currentPage":a[1]||(a[1]=i=>A.value=i),"page-size":10,size:P.value,disabled:_.value,background:T.value,layout:"total, prev, pager, next,jumper",total:e(w),onCurrentChange:B,style:{"margin-top":"30px"}},null,8,["current-page","size","disabled","background","total"]),l(X,{modelValue:e(m),"onUpdate:modelValue":a[3]||(a[3]=i=>N(m)?m.value=i:m=i),title:"删除确认",width:"500","align-center":""},{footer:t(()=>[V("div",ie,[l(v,{onClick:a[2]||(a[2]=i=>N(m)?m.value=!1:m=!1)},{default:t(()=>[c("取消")]),_:1}),l(v,{type:"danger",onClick:F},{default:t(()=>[c(" 删除 ")]),_:1})])]),default:t(()=>[de]),_:1},8,["modelValue"]),l(ne,{articleId:e(u),addOrUpdate:e(f),ref_key:"articleDialog",ref:g,onRefresh:s},null,8,["articleId","addOrUpdate"])],64)}}});export{ce as default};
